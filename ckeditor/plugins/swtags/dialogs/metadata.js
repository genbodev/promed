(function(){	/**	 * Dialog reused by both 'add' and 'edit' commands.	 * @param {Object} editor	 * @param {String} command	The command name which indicate what the current command is.	 */	function swmetadataDialog( editor, command )	{		function getSwMetaData(editor)		{			var path = new CKEDITOR.dom.elementPath( editor.getSelection().getStartElement() ),				lastElement = path.lastElement,				data = lastElement && lastElement.getAscendant( 'data', true );			if (data && data.getAttribute('_cke_real_class') == 'metadata')				return data;			return null;		}				var title = 'Добавить служебные даннные к шаблону';		if (command == 'edit')		{			title = 'Редактирование служебных даннных шаблона';		}		//var value_null = 'неопределено';		var dialog = {			title : title,			minWidth : 400,			minHeight : 200,			onShow : function()			{				if ( command == 'edit' )				{					this._element = getSwMetaData(editor);					if (this._element)					{						this.setValueOf('swmetadata_tab1', 'swmetadata_id', this._element.getAttribute('id'));						//this.setValueOf('swmetadata_tab1', 'swmetadata_defaultValue', this._element.getHtml());					}				}			},			onOk: function() {				var id = this.getContentElement( 'swmetadata_tab1', 'swmetadata_id').getInputElement().getValue();				//var defaultValue = this.getContentElement( 'swmetadata_tab1', 'swmetadata_defaultValue').getInputElement().getValue();				//defaultValue = defaultValue?defaultValue:value_null;				var defaultValue = '&nbsp;';				if ( command == 'add' )				{					var data = editor.getData();					editor.setData(						'<span class="metadata" id="' + id						+ '" style="' + CKEDITOR.config.swtagStyles_metadata.print						+ '">' + defaultValue						+ '</span' + data					);				}				if ( command == 'edit' && this._element)				{					this._element.setAttribute('id',id);					this._element.setHtml(defaultValue);				}			},			onHide : function()			{				delete this._element;			},			contents : [{				id : 'swmetadata_tab1',				label : 'Параметры служебных данных',				title : 'Параметры служебных данных',				expand:true,				padding:0,				elements : [{					type:'vbox',padding:1,children:[{						type:'hbox',children:[{							id : 'swmetadata_content',							type : 'html',							html :'<div><p>После создания служебные данные <b>будут невидимы</b> при заполнении шаблона и в печатной форме</p><br />'						}]					},{						type:'hbox',children:[{							id : 'swmetadata_id',							type : 'text',							label : 'Идентификатор'							,default:''						}]					/*},{						type:'hbox',children:[{							id : 'swmetadata_defaultValue',							type : 'text',							label : 'Значение по умолчанию'							,default: ''						}]*/					}]				}]			}]			//,buttons:[CKEDITOR.dialog.okButton]		};		return dialog;	}	CKEDITOR.dialog.add('swmetadata_add', function(editor) {		return swmetadataDialog(editor,'add');	});	CKEDITOR.dialog.add('swmetadata_edit', function(editor) {		return swmetadataDialog(editor,'edit');	});})();