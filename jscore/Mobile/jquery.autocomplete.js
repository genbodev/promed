(function (e) {"use strict";function n(e, n, r) {var i = "(" + r.replace(t, "\\$1") + ")";return e.replace(new RegExp(i, "gi"), "<strong>$1</strong>")}function r(t, r) {this.el = e(t);this.el.attr("autocomplete", "off");this.suggestions = [];this.data = [];this.badQueries = [];this.selectedIndex = -1;this.currentValue = this.el.val();this.intervalId = 0;this.cachedResponse = [];this.onChangeInterval = null;this.onChange = null;this.ignoreValueChange = false;this.serviceUrl = r.serviceUrl;this.isLocal = false;this.options = {autoSubmit: false,minChars: 1,maxHeight: 300,deferRequestBy: 0,width: 0,highlight: true,params: {},fnFormatResult: n,delimiter: null,zIndex: 9999,lookupFn: function () {}};this.initialize();this.setOptions(r);this.el.data("autocomplete", this)}var t = new RegExp("(\\" + ["/", ".", "*", "+", "?", "|", "(", ")", "[", "]", "{", "}", "\\"].join("|\\") + ")", "g");e.fn.autocomplete = function (t, n) {var i;if (typeof t === "string") {i = this.data("autocomplete");if (typeof i[t] === "function") {i[t](n)}} else {i = new r(this.get(0) || e("<input />"), t)}return i};r.prototype = {killerFn: null,initialize: function () {var t = this,n = Math.floor(Math.random() * 1048576).toString(16),r = "Autocomplete_" + n,i = function (e) {t.onKeyPress(e)};this.killerFn = function (n) {if (e(n.target).parents(".autocomplete").size() === 0) {t.killSuggestions();t.disableKillerFn()}};if (!this.options.width) {this.options.width = this.el.outerWidth()}this.mainContainerId = "AutocompleteContainter_" + n;e('<div id="' + this.mainContainerId + '" style="position:absolute;z-index:9999;"><div class="autocomplete-w1"><div class="autocomplete" id="' + r + '" style="display:none; width:300px;"></div></div></div>').appendTo("body");this.container = e("#" + r);this.fixPosition();if (window.opera) {this.el.keypress(i)} else {this.el.keydown(i)}this.el.keyup(function (e) {t.onKeyUp(e)});this.el.blur(function () {t.enableKillerFn()});this.el.focus(function () {t.fixPosition()});this.el.change(function () {t.onValueChanged()})},extendOptions: function (t) {e.extend(this.options, t)},setOptions: function (t) {var n = this.options;this.extendOptions(t);if (n.lookup || n.isLocal) {this.isLocal = true;if (e.isArray(n.lookup)) {n.lookup = {suggestions: n.lookup,data: []}}}e("#" + this.mainContainerId).css({zIndex: n.zIndex});this.container.css({maxHeight: n.maxHeight + "px",width: n.width})},clearCache: function () {this.cachedResponse = [];this.badQueries = []},disable: function () {this.disabled = true},enable: function () {this.disabled = false},fixPosition: function () {var t = this.el.offset();e("#" + this.mainContainerId).css({top: t.top + this.el.outerHeight() + "px",left: t.left + "px"})},enableKillerFn: function () {var t = this;e(document).bind("click", t.killerFn)},disableKillerFn: function () {var t = this;e(document).unbind("click", t.killerFn)},killSuggestions: function () {var e = this;e.stopKillSuggestions();e.intervalId = window.setInterval(function () {e.hide();e.stopKillSuggestions()}, 300)},stopKillSuggestions: function () {window.clearInterval(this.intervalId)},onValueChanged: function () {this.change(this.selectedIndex)},onKeyPress: function (e) {if (this.disabled || !this.enabled) {return}switch (e.keyCode) {case 27:this.el.val(this.currentValue);this.hide();break;case 9:case 13:if (this.selectedIndex === -1) {this.hide();return}this.select(this.selectedIndex);if (e.keyCode === 9) {return}break;case 38:this.moveUp();break;case 40:this.moveDown();break;default:return}e.stopImmediatePropagation();e.preventDefault()},onKeyUp: function (e) {if (this.disabled) {return}switch (e.keyCode) {case 38:case 40:return}clearInterval(this.onChangeInterval);if (this.currentValue !== this.el.val()) {if (this.options.deferRequestBy > 0) {var t = this;this.onChangeInterval = setInterval(function () {t.onValueChange()}, this.options.deferRequestBy)} else {this.onValueChange()}}},onValueChange: function () {clearInterval(this.onChangeInterval);this.currentValue = this.el.val();var e = this.getQuery(this.currentValue);this.selectedIndex = -1;if (this.ignoreValueChange) {this.ignoreValueChange = false;return}if (e === "" || e.length < this.options.minChars) {this.hide()} else {this.getSuggestions(e)}},getQuery: function (t) {var n, r;n = this.options.delimiter;if (!n) {return e.trim(t)}r = t.split(n);return e.trim(r[r.length - 1])},getSuggestionsComlete: function (t) {var n, r, i, s, o, u;i = this.options.lookup;s = i.suggestions.length;n = {suggestions: [],data: []};t = t.toLowerCase();for (u = 0; u < s; u++) {o = i.suggestions[u];n.suggestions.push(o);n.data.push(i.data[u])}if (n && e.isArray(n.suggestions)) {this.suggestions = n.suggestions;this.data = n.data;this.suggest()}},getSuggestions: function (t) {var n, r, i, s, o;r = e("input[name=CloseCardDiag]").val();s = r;i = null;switch (r.length) {case 1:i = "code1";break;case 2:i = "code2";break;case 3:case 4:s = r.slice(0, 3);i = "code3";break;case 5:s = r.slice(0, 3) + "" + r.slice(4, 5) + "";i = "code4";break;default:i = null;break}o = typeof this.options.lookup.suggestions == "undefined" ? 0 : this.options.lookup.suggestions.length;var u = this;var params = [s.toUpperCase()];var additionalCondition = '';if (r.length > 1) {additionalCondition = 'OR name LIKE ?';params.push('%'+r+'%') ;}db.transaction(function (e) {e.executeSql('SELECT code3||"."||replace(code4,code3,"")||" "||name as suggestion,' + "id as id" + " FROM Diags WHERE " + i + "=? "+additionalCondition+" LIMIT 10 ", params, function (e, r) {var i = new Array,s = new Array;console.log({"results.rows.length": r.rows.length});i = new Array;for (n = 0; n < r.rows.length; n++) {i.push(r.rows.item(n).suggestion);s.push(r.rows.item(n).id)}u.options.lookup = {suggestions: i,data: s};u.getSuggestionsComlete(t)}, onError)})},hide: function () {this.enabled = false;this.selectedIndex = -1;this.container.hide()},suggest: function () {if (this.suggestions.length === 0) {this.hide();return}var t, n, r, i, s, o, u, a, f;t = this;n = this.suggestions.length;i = this.options.fnFormatResult;s = this.getQuery(this.currentValue);a = function (e) {return function () {t.activate(e)}};f = function (e) {return function () {t.select(e)}};this.container.hide().empty();for (o = 0; o < n; o++) {u = this.suggestions[o];r = e((t.selectedIndex === o ? '<div class="selected"' : "<div") + ' title="' + u + '">' + i(u, this.data[o], s) + "</div>");r.mouseover(a(o));r.click(f(o));this.container.append(r)}this.enabled = true;this.container.show()},activate: function (t) {var n, r;n = this.container.children();if (this.selectedIndex !== -1 && n.length > this.selectedIndex) {e(n.get(this.selectedIndex)).removeClass()}this.selectedIndex = t;if (this.selectedIndex !== -1 && n.length > this.selectedIndex) {r = n.get(this.selectedIndex);e(r).addClass("selected");return r}return null},deactivate: function (e, t) {e.className = "";if (this.selectedIndex === t) {this.selectedIndex = -1}},select: function (e) {var t, n;t = this.suggestions[e];if (t) {this.el.val(t);if (this.options.autoSubmit) {n = this.el.parents("form");if (n.length > 0) {n.get(0).submit()}}this.ignoreValueChange = true;this.hide();this.onSelect(e)}},change: function (t) {var n, r, i, s, o;i = this;n = this.suggestions[t];if (n) {s = i.suggestions[t];o = i.data[t];i.el.val(i.getValue(s))} else {s = "";o = -1}r = i.options.onChange;if (e.isFunction(r)) {r(s, o, i.el)}},moveUp: function () {if (this.selectedIndex === -1) {return}if (this.selectedIndex === 0) {this.container.children().get(0).className = "";this.selectedIndex = -1;this.el.val(this.currentValue);return}this.adjustScroll(this.selectedIndex - 1)},moveDown: function () {if (this.selectedIndex === this.suggestions.length - 1) {return}this.adjustScroll(this.selectedIndex + 1)},adjustScroll: function (e) {var t, n, r, i;t = this.activate(e);n = t.offsetTop;r = this.container.scrollTop();i = r + this.options.maxHeight - 25;if (n < r) {this.container.scrollTop(n)} else if (n > i) {this.container.scrollTop(n - this.options.maxHeight + 25)}this.el.val(this.getValue(this.suggestions[e]))},onSelect: function (t) {var n = this,r = n.options.onSelect,i = n.suggestions[t],s = n.data[t];n.el.val(n.getValue(i));if (e.isFunction(r)) {r(i, s, n.el)}},getValue: function (e) {var t = this,n = t.options.delimiter,r, i;if (!n) {return e}r = t.currentValue;i = r.split(n);if (i.length === 1) {return e}return r.substr(0, r.length - i[i.length - 1].length) + e}}})(jQuery)